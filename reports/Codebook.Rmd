---
title: "Codebook | Corpus of Resolutions: UN Security Council"
author: "Se√°n Fobbe, Niccolo Ridi and Lorenzo Gasbarri"
geometry: margin=3cm
papersize: a4
fontsize: 11pt
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
    pandoc_args: --listings
    includes:
      in_header: ../tex/Preamble_EN.tex
      before_body: [../temp/Definitions.tex, ../tex/Titlepage_Codebook.tex]
bibliography: ../temp/packages.bib
nocite: '@*'
---




```{r, setup, include=FALSE}
knitr::opts_chunk$set(fig.path = file.path("..", "analysis/"),
                      dev = config$fig$format,
                      dpi = config$fig$dpi,
                      fig.align = config$fig$align,
                      echo = FALSE,
                      warning = FALSE,
                      message = FALSE)

```


```{r, echo = FALSE}
tar_load(latexdefs)
tar_load(dt.var_codebook)
tar_load(var_lingstats)
tar_load(lingstats.summary)
tar_load(dt.final)
tar_load(igraph_citations)


```



# Introduction

Lorem Ipsum.






# Reading Files

The data are published in open, interoperable and widely used formats (CSV, TXT, PDF). They can be used with all modern programming languages (e.g. Python or R) and graphical interfaces. The PDF collections are intended to facilitate traditional legal research.

**Important:** Missing values are always coded as \enquote{NA}.


## CSV Files

 Working with the CSV files is recommended. CSV\footnote{The CSV format is defined in RFC 4180: <\url{https://tools.ietf.org/html/rfc4180}>.} is an open and simple machine-readable tabular data format. In this data set values are separated by commas. Each column is a variable and each row is a document. Variables are explained in detail in section \ref{variables}.


To read \textbf{CSV} files into R I strongly recommend using the fast file reader **fread()** from the **data.table** package (available on CRAN). The file can be read into \textbf{R} like so: 

```{r, eval = FALSE, echo = TRUE}
library(data.table)
unsc <- fread("CR-UNSC_2023-08-23_EN_CSV_Main-Dataset.csv")
```



## TXT Files

The \textbf{TXT} files, including metadata, can be read into \textbf{R} with the package \textbf{readtext} (available on CRAN) thus:

```{r, eval = FALSE, echo = TRUE}
library(readtext)
unsc <- readtext("txt_res_en/*.txt",
                 docvarsfrom = "filenames", 
                 docvarnames = c("body",
                                 "doctype",
                                 "res_no",
                                 "year",
                                 "language"),
                 dvsep = "_", 
                 encoding = "UTF-8")

```






# Data Set Design


## Description of Data Set

The \textbf{\datatitle\ (\datashort)} collects and structures in human- and machine-readable form all published resolutions of the United Nations Security Council. Complementary data sets provide citation data (to UNSC and UNGA resolutions) and easily importable biblopgrahic data.





## Table of Sources


\begin{centering}
\begin{longtable}{P{5cm}p{9cm}}

\toprule
 Data Source & Citation \\

\midrule

 Primary Data Source & \url{https://digitallibrary.un.org/}\\
 Source Code & \url{\softwareversionurldoi}\\

\bottomrule

\end{longtable}
\end{centering}



## Data Collection

Data were collected with the explicit consent of the Secretariat of the \unsc . All documents were downloaded via TLS-encrypted connections and cryptographically signed after data processing was complete. The data set collects all resolutions issued by the \unsc\ that were published on the UN Digital Library on \version .

 




```{r, CR-UNSC_00_Pipeline_Graph_blackwhite, fig.width = 12, fig.height = 14, fig.pos = "p", fig.cap = "The complete data set compilation process."}


edgelist <- tar_network(targets_only = TRUE)$edges
setDT(edgelist)

g  <- igraph::graph.data.frame(edgelist,
                               directed = TRUE)


ggraph(g,
       'sugiyama') + 
    geom_edge_diagonal(colour = "grey70")+
    geom_node_point(size = 2)+
    geom_node_text(aes(label = name),
                   size = 2,
                   repel = TRUE)+
    theme_void()+
    labs(
        title = paste(prefix.figuretitle,
                      "| Complete data set compilation process."),
        caption = caption
    )+
    theme(
        plot.title = element_text(size = 14,
                                  face = "bold"),
        plot.margin = margin(10, 20, 10, 10)
    )

```




# Variable Descriptions

## General Remarks

- Missing values are always coded as \enquote{NA}.
- All Strings are encoded in UTF-8.
- A significant part of the metadata has been drawn from the UN Digital Library metadata records and was originally curated by the UN Digital Library.


## ID Variables

The group ID variables identifies the resolution, its draft, meeting record and various associated documents with symbols and dates.


```{r}

kable(dt.var_codebook[group == "1_id", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```

## Text Variables

Text variables contain the full text of all six language versions of the UN Security Council's resolutions. Also provided are pre-computed statistical measures of the length of each resolution (English text only).


```{r}

kable(dt.var_codebook[group == "2_text", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```

## Thematic Variables

Thematic variables contain a number of different classifications of UN Security Council texts and will prove especially useful for refining the data to fit a thematic research question.


```{r}

kable(dt.var_codebook[group == "3_thematic", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```

## Vote Variables

Voting variables document the voting results and patterns of UN Security Council's resolutions. Note that the voting variables contain the geographic distribution of votes.


```{r}

kable(dt.var_codebook[group == "4_vote", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```

## Geographic Variables

Geographic variables provide insight into the geographic distribution of the UN Security Council's attention. Note that the voting variables contain the geographic distribution of votes.


```{r}

kable(dt.var_codebook[group == "5_geo", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```

## Source Variables

Source variables provide explicit references for the data sources via URLs to UN Digital Library record pages and documents.



```{r}

kable(dt.var_codebook[group == "6_url", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```


## Meta Variables

Meta variables provide further information on the data set, including version, DOIs and licensing information. These document provenance and ensure compliance with FAIR Data Principles F1, F3 and R1.1.



```{r}

kable(dt.var_codebook[group == "7_misc", .(varname, type, description)],
      format = "latex",
      align = 'P{3.5cm}P{3cm}p{8cm}',
      booktabs = TRUE,
      longtable = TRUE,
      escape = FALSE,
      col.names = c("Variable",
                    "Type",
                    "Description"))  %>% kable_styling(latex_options = "repeat_header")

```











# Linguistic Metrics


## Explanation of Metrics

We provide a number of classic linguistic metrics and visualize their distributions to better communicate the scope of the corpus and its constituent documents:


\medskip

\begin{centering}
\begin{longtable}{P{3.5cm}p{10.5cm}}

\toprule

Metric & Definition\\

\midrule

Characters & Characters roughly correspond to graphemes, the smallest functional unit in a writing system. The word \enquote{judge} is composed of 5 characters, for example.\\
Tokens & An arbitrary character sequence delimited by whitespace on both sides, e.g. it roughly corresponds to the notion of a \enquote{word}. However, due to its strictly syntactical definition it might also include arbitrary sequences of numbers or special characters.\\
Types & Unique tokens. If, for example, the token \enquote{human} appeared one hundred times in a given document, it would be counted as only one type. \\
Sentences & Corresponds approximately to the colloquial definition of a sentence. The exact rules for determining sentence boundaries are very complex and may be reviewed in \enquote{Unicode Standard: Annex No 29}.\\

\bottomrule

\end{longtable}
\end{centering}





## Summary Statistics



```{r}



kable(lingstats.summary,
      digits = 2,
      format.args = list(big.mark = ","),
      format = "latex",
      booktabs = TRUE,
      longtable = TRUE)


```



## Distributions of Document Length

The diagrams in this section are combined violin and box plots. They are especially useful in visualizing distributions of quantitative variables. Their interpretation is fairly straightforward: the greater the area under the curve for a given range, the more frequent the values are in this range. The thick center line of the box indicates the median, the outer lines of the box the first and third quartiles. Whiskers extend outwards to 1.5 times the inter-quartile range (IQR). Outliers beyond 1.5 times IQR are shown as individual points.

Please note that the x-axis is logarithmically scaled, i.e. in powers of 10. It therefore increases in a non-linear fashion. Additional sub-markings are included to assist with interpretation.



```{r, CR-UNSC_EN_10_Distributions_LinguisticMetrics, fig.height = 10, fig.width = 8.3}
## When plotting a boxplot on a logarithmic scale the standard geom_boxplot() function from ggplot2 incorrectly performs the statistical transformation first before calculating the boxplot statistics. While median and quartiles are based on ordinal position the inter-quartile range differs depending on when statistical transformation is performed.

## Solutions are based on this SO question: https://stackoverflow.com/questions/38753628/ggplot-boxplot-length-of-whiskers-with-logarithmic-axis


dt.allmetrics.en <- melt(var_lingstats,
                         measure.vars = rev(c("nchars",
                                              "ntokens",
                                              "ntypes",
                                              "nsentences")))

ggplot(dt.allmetrics.en, aes(x = value,
                             y = variable))+
    geom_violin()+
    stat_summary(fun.data = f.boxplot.body,
                 geom = "errorbar",
                 width = 0.1) +
    stat_summary(fun.data = f.boxplot.body,
                 geom = "boxplot",
                 width = 0.1) +
    stat_summary(fun.data = f.boxplot.outliers,
                 geom = "point",
                 size =  0.5,
                 alpha = 0.1)+
    scale_x_log10(breaks = trans_breaks("log10", function(x) 10^x),
                  labels = trans_format("log10", math_format(10^.x)))+
    annotation_logticks(sides = "b")+
    coord_cartesian(xlim = c(1, 10^6))+
    scale_y_discrete(labels = rev(c("Characters",
                                    "Tokens",
                                    "Types",
                                    "Sentences")))+
    theme_bw() +
    labs(
        title = paste(prefix.figuretitle,
                      "| Distributions of Document Length (EN)"),
        caption = caption,
        x = "Value",
        y = "Linguistic Metric"
    )+
    theme(
        text = element_text(size = 14),
        plot.title = element_text(size = 14,
                                  face = "bold"),
        legend.position = "none",
        plot.margin = margin(10, 20, 10, 10)
    )

        

```



# Metadata Frequency Tables
 
\ra{1.3}
 

## Resolutions By Year


## Concerned Countries







# Cryptographic Signatures


## Two Phase Signature


The integrity and veracity of the ZIP archives and other output of the data set are guaranteed with two-phase *hash-and-sign* signature process.

In **Phase I** the data pipeline automatically computes digital fingerprints (hashes) with two different secure algorithms (SHA2-256 und SHA3-512) and stores these in a CSV file.

In **Phase II** the CSV files with hashes is manually signed with a secret GPG key.

This process ensures that the compilation of the data set can be performed by anyone, such as in scientific replication studies, but provides the same guarantees as signing the full data set would. 



## Personal GPG Key

The CSV file is signed with the personal GPG key of the first author. The public key is included with the data set and source code publication on Zenodo, as well as the project GitHub repository. The key is identified as follows:
 
 **Name:** Sean Fobbe (fobbe-data@posteo.de)
 
 **Fingerprint:** FE6F B888 F0E5 656C 1D25  3B9A 50C4 1384 F44A 4E42





\newpage






```{r, results = "asis"}
cat(readLines(tar_read(changelog)),
    sep = "\n")

```






# Replication Parameters


```{r}
system2("openssl", "version", stdout = TRUE)

sessionInfo()

```


# Bibliography
